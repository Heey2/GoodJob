package com.goodjob;

import java.io.BufferedReader;
import java.io.InputStreamReader;
import java.net.URL;
import java.util.ArrayList;

import org.json.simple.JSONArray;
import org.json.simple.JSONObject;
import org.json.simple.parser.JSONParser;

import com.goodjob.test.TestDAO;

public class SearchInfo {
	public static void main(String[] args) {
		TestDAO dao = new TestDAO();

		ArrayList<Company> list = dao.comList();
		//e11f4c31b1b2d90885677aedb28703686d37aecc
		for (Company com : list) {
			//https://opendart.fss.or.kr/api/company.json?crtfc_key=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&corp_code=00126380
			String path = "https://opendart.fss.or.kr/api/company.json?crtfc_key=e11f4c31b1b2d90885677aedb28703686d37aecc&corp_code="+com.getCode();
			try {
				URL url = new URL(path);

				// JSON 결과
				BufferedReader bf;
				bf = new BufferedReader(new InputStreamReader(url.openStream(), "UTF-8"));
				String result = bf.readLine();
				bf.close();

				JSONParser parser = new JSONParser();
				JSONObject info = (JSONObject) parser.parse(result);
				
				com.setEst_dt((String) ((JSONObject) info).get("est_dt"));
				com.setCeo_nm((String) ((JSONObject) info).get("ceo_nm"));
				
				System.out.println(com.getName());
				System.out.println(com.getEst_dt());
				System.out.println(com.getCeo_nm());
				//break;
				
				//int end = dao.updateInfo(com);
			} catch (Exception e) {
				System.out.println("emain");
				e.printStackTrace();
			}
		}
	}
}
